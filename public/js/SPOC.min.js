/*! SPOC 15-02-2016 */
(function(){"use strict";function a(a){return"function"==typeof a||"object"==typeof a&&null!==a}function b(a){return"function"==typeof a}function c(a){return"object"==typeof a&&null!==a}function d(){}function e(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}function f(a){var b=a._promiseCallbacks;return b||(b=a._promiseCallbacks={}),b}function g(a,b){return"onerror"===a?void wa.on("error",b):2!==arguments.length?wa[a]:void(wa[a]=b)}function h(){setTimeout(function(){for(var a,b=0;b<xa.length;b++){a=xa[b];var c=a.payload;c.guid=c.key+c.id,c.childGuid=c.key+c.childId,c.error&&(c.stack=c.error.stack),wa.trigger(a.name,a.payload)}xa.length=0},50)}function i(a,b,c){1===xa.push({name:a,payload:{key:b._guidKey,id:b._id,eventName:a,detail:b._result,childId:c&&c._id,label:b._label,timeStamp:ta(),error:wa["instrument-with-stack"]?new Error(b._label):null}})&&h()}function j(a,b,c){var d=this,e=d._state;if(e===Ja&&!a||e===Ka&&!b)return wa.instrument&&ya("chained",d,d),d;d._onError=null;var f=new d.constructor(u,c),g=d._result;if(wa.instrument&&ya("chained",d,f),e){var h=arguments[e-1];wa.async(function(){I(e,f,h,g)})}else E(d,f,a,b);return f}function k(a,b){var c=this;if(a&&"object"==typeof a&&a.constructor===c)return a;var d=new c(u,b);return A(d,a),d}function l(a,b,c){return a===Ja?{state:"fulfilled",value:c}:{state:"rejected",reason:c}}function m(a,b,c,d){this._instanceConstructor=a,this.promise=new a(u,d),this._abortOnReject=c,this._validateInput(b)?(this._input=b,this.length=b.length,this._remaining=b.length,this._init(),0===this.length?C(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&C(this.promise,this._result))):D(this.promise,this._validationError())}function n(a,b){return new Ba(this,a,!0,b).promise}function o(a,b){function c(a){A(f,a)}function d(a){D(f,a)}var e=this,f=new e(u,b);if(!sa(a))return D(f,new TypeError("You must pass an array to race.")),f;for(var g=a.length,h=0;f._state===Ia&&g>h;h++)E(e.resolve(a[h]),void 0,c,d);return f}function p(a,b){var c=this,d=new c(u,b);return D(d,a),d}function q(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function r(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function s(a,b){this._id=Ga++,this._label=b,this._state=void 0,this._result=void 0,this._subscribers=[],wa.instrument&&ya("created",this),u!==a&&("function"!=typeof a&&q(),this instanceof s?J(this,a):r())}function t(){return new TypeError("A promises callback cannot return that same promise.")}function u(){}function v(a){try{return a.then}catch(b){return La.error=b,La}}function w(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function x(a,b,c){wa.async(function(a){var d=!1,e=w(c,b,function(c){d||(d=!0,b!==c?A(a,c,void 0):C(a,c))},function(b){d||(d=!0,D(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,D(a,e))},a)}function y(a,b){b._state===Ja?C(a,b._result):b._state===Ka?(b._onError=null,D(a,b._result)):E(b,void 0,function(c){b!==c?A(a,c,void 0):C(a,c)},function(b){D(a,b)})}function z(a,c,d){c.constructor===a.constructor&&d===za&&constructor.resolve===Aa?y(a,c):d===La?D(a,La.error):void 0===d?C(a,c):b(d)?x(a,c,d):C(a,c)}function A(b,c){b===c?C(b,c):a(c)?z(b,c,v(c)):C(b,c)}function B(a){a._onError&&a._onError(a._result),F(a)}function C(a,b){a._state===Ia&&(a._result=b,a._state=Ja,0===a._subscribers.length?wa.instrument&&ya("fulfilled",a):wa.async(F,a))}function D(a,b){a._state===Ia&&(a._state=Ka,a._result=b,wa.async(B,a))}function E(a,b,c,d){var e=a._subscribers,f=e.length;a._onError=null,e[f]=b,e[f+Ja]=c,e[f+Ka]=d,0===f&&a._state&&wa.async(F,a)}function F(a){var b=a._subscribers,c=a._state;if(wa.instrument&&ya(c===Ja?"fulfilled":"rejected",a),0!==b.length){for(var d,e,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?I(c,d,e,f):e(f);a._subscribers.length=0}}function G(){this.error=null}function H(a,b){try{return a(b)}catch(c){return Ma.error=c,Ma}}function I(a,c,d,e){var f,g,h,i,j=b(d);if(j){if(f=H(d,e),f===Ma?(i=!0,g=f.error,f=null):h=!0,c===f)return void D(c,t())}else f=e,h=!0;c._state!==Ia||(j&&h?A(c,f):i?D(c,g):a===Ja?C(c,f):a===Ka&&D(c,f))}function J(a,b){var c=!1;try{b(function(b){c||(c=!0,A(a,b))},function(b){c||(c=!0,D(a,b))})}catch(d){D(a,d)}}function K(a,b,c){this._superConstructor(a,b,!1,c)}function L(a,b){return new K(Ha,a,b).promise}function M(a,b){return Ha.all(a,b)}function N(a,b){Ya[Ra]=a,Ya[Ra+1]=b,Ra+=2,2===Ra&&Oa()}function O(){var a=process.nextTick,b=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(b)&&"0"===b[1]&&"10"===b[2]&&(a=setImmediate),function(){a(T)}}function P(){return function(){Na(T)}}function Q(){var a=0,b=new Va(T),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function R(){var a=new MessageChannel;return a.port1.onmessage=T,function(){a.port2.postMessage(0)}}function S(){return function(){setTimeout(T,1)}}function T(){for(var a=0;Ra>a;a+=2){var b=Ya[a],c=Ya[a+1];b(c),Ya[a]=void 0,Ya[a+1]=void 0}Ra=0}function U(){try{var a=require,b=a("vertx");return Na=b.runOnLoop||b.runOnContext,P()}catch(c){return S()}}function V(a){var b={};return b.promise=new Ha(function(a,c){b.resolve=a,b.reject=c},a),b}function W(a,c,d){return Ha.all(a,d).then(function(a){if(!b(c))throw new TypeError("You must pass a function as filter's second argument.");for(var e=a.length,f=new Array(e),g=0;e>g;g++)f[g]=c(a[g]);return Ha.all(f,d).then(function(b){for(var c=new Array(e),d=0,f=0;e>f;f++)b[f]&&(c[d]=a[f],d++);return c.length=d,c})})}function X(a,b,c){this._superConstructor(a,b,!0,c)}function Y(a,b,c){this._superConstructor(a,b,!1,c)}function Z(a,b){return new Y(Ha,a,b).promise}function $(a,b){return new _a(Ha,a,b).promise}function _(a,c,d){return Ha.all(a,d).then(function(a){if(!b(c))throw new TypeError("You must pass a function as map's second argument.");for(var e=a.length,f=new Array(e),g=0;e>g;g++)f[g]=c(a[g]);return Ha.all(f,d)})}function aa(){this.value=void 0}function ba(a){try{return a.then}catch(b){return eb.value=b,eb}}function ca(a,b,c){try{a.apply(b,c)}catch(d){return eb.value=d,eb}}function da(a,b){for(var c,d,e={},f=a.length,g=new Array(f),h=0;f>h;h++)g[h]=a[h];for(d=0;d<b.length;d++)c=b[d],e[c]=g[d+1];return e}function ea(a){for(var b=a.length,c=new Array(b-1),d=1;b>d;d++)c[d-1]=a[d];return c}function fa(a,b){return{then:function(c,d){return a.call(b,c,d)}}}function ga(a,b){var c=function(){for(var c,d=this,e=arguments.length,f=new Array(e+1),g=!1,h=0;e>h;++h){if(c=arguments[h],!g){if(g=ja(c),g===fb){var i=new Ha(u);return D(i,fb.value),i}g&&g!==!0&&(c=fa(g,c))}f[h]=c}var j=new Ha(u);return f[e]=function(a,c){a?D(j,a):void 0===b?A(j,c):b===!0?A(j,ea(arguments)):sa(b)?A(j,da(arguments,b)):A(j,c)},g?ia(j,f,a,d):ha(j,f,a,d)};return c.__proto__=a,c}function ha(a,b,c,d){var e=ca(c,d,b);return e===eb&&D(a,e.value),a}function ia(a,b,c,d){return Ha.all(b).then(function(b){var e=ca(c,d,b);return e===eb&&D(a,e.value),a})}function ja(a){return a&&"object"==typeof a?a.constructor===Ha?!0:ba(a):!1}function ka(a,b){return Ha.race(a,b)}function la(a,b){return Ha.reject(a,b)}function ma(a,b){return Ha.resolve(a,b)}function na(a){throw setTimeout(function(){throw a}),a}function oa(a,b){wa.async(a,b)}function pa(){wa.on.apply(wa,arguments)}function qa(){wa.off.apply(wa,arguments)}var ra;ra=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var sa=ra,ta=Date.now||function(){return(new Date).getTime()},ua=Object.create||function(a){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof a)throw new TypeError("Argument must be an object");return d.prototype=a,new d},va={mixin:function(a){return a.on=this.on,a.off=this.off,a.trigger=this.trigger,a._promiseCallbacks=void 0,a},on:function(a,b){if("function"!=typeof b)throw new TypeError("Callback must be a function");var c,d=f(this);c=d[a],c||(c=d[a]=[]),-1===e(c,b)&&c.push(b)},off:function(a,b){var c,d,g=f(this);return b?(c=g[a],d=e(c,b),void(-1!==d&&c.splice(d,1))):void(g[a]=[])},trigger:function(a,b,c){var d,e,g=f(this);if(d=g[a])for(var h=0;h<d.length;h++)(e=d[h])(b,c)}},wa={instrument:!1};va.mixin(wa);var xa=[],ya=i,za=j,Aa=k,Ba=m;m.prototype._validateInput=function(a){return sa(a)},m.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},m.prototype._init=function(){this._result=new Array(this.length)},m.prototype._enumerate=function(){for(var a=this.length,b=this.promise,c=this._input,d=0;b._state===Ia&&a>d;d++)this._eachEntry(c[d],d)},m.prototype._settleMaybeThenable=function(a,b){var c=this._instanceConstructor,d=c.resolve;if(d===Aa){var e=v(a);if(e===za&&a._state!==Ia)a._onError=null,this._settledAt(a._state,b,a._result);else if("function"!=typeof e)this._remaining--,this._result[b]=this._makeResult(Ja,b,a);else if(c===Ha){var f=new c(u);z(f,a,e),this._willSettleAt(f,b)}else this._willSettleAt(new c(function(b){b(a)}),b)}else this._willSettleAt(d(a),b)},m.prototype._eachEntry=function(a,b){c(a)?this._settleMaybeThenable(a,b):(this._remaining--,this._result[b]=this._makeResult(Ja,b,a))},m.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===Ia&&(this._remaining--,this._abortOnReject&&a===Ka?D(d,c):this._result[b]=this._makeResult(a,b,c)),0===this._remaining&&C(d,this._result)},m.prototype._makeResult=function(a,b,c){return c},m.prototype._willSettleAt=function(a,b){var c=this;E(a,void 0,function(a){c._settledAt(Ja,b,a)},function(a){c._settledAt(Ka,b,a)})};var Ca=n,Da=o,Ea=p,Fa="rsvp_"+ta()+"-",Ga=0,Ha=s;s.cast=Aa,s.all=Ca,s.race=Da,s.resolve=Aa,s.reject=Ea,s.prototype={constructor:s,_guidKey:Fa,_onError:function(a){var b=this;wa.after(function(){b._onError&&wa.trigger("error",a,b._label)})},then:za,"catch":function(a,b){return this.then(void 0,a,b)},"finally":function(a,b){var c=this,d=c.constructor;return c.then(function(b){return d.resolve(a()).then(function(){return b})},function(b){return d.resolve(a()).then(function(){return d.reject(b)})},b)}};var Ia=void 0,Ja=1,Ka=2,La=new G,Ma=new G;K.prototype=ua(Ba.prototype),K.prototype._superConstructor=Ba,K.prototype._makeResult=l,K.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var Na,Oa,Pa=L,Qa=M,Ra=0,Sa=({}.toString,N),Ta="undefined"!=typeof window?window:void 0,Ua=Ta||{},Va=Ua.MutationObserver||Ua.WebKitMutationObserver,Wa="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Xa="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Ya=new Array(1e3);Oa=Wa?O():Va?Q():Xa?R():void 0===Ta&&"function"==typeof require?U():S();var Za=V,$a=W,_a=X;X.prototype=ua(Ba.prototype),X.prototype._superConstructor=Ba,X.prototype._init=function(){this._result={}},X.prototype._validateInput=function(a){return a&&"object"==typeof a},X.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},X.prototype._enumerate=function(){var a=this,b=a.promise,c=a._input,d=[];for(var e in c)b._state===Ia&&Object.prototype.hasOwnProperty.call(c,e)&&d.push({position:e,entry:c[e]});var f=d.length;a._remaining=f;for(var g,h=0;b._state===Ia&&f>h;h++)g=d[h],a._eachEntry(g.entry,g.position)},Y.prototype=ua(_a.prototype),Y.prototype._superConstructor=Ba,Y.prototype._makeResult=l,Y.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var ab,bb=Z,cb=$,db=_,eb=new aa,fb=new aa,gb=ga;if("object"==typeof self)ab=self;else{if("object"!=typeof global)throw new Error("no global: `self` or `global` found");ab=global}var hb=ab,ib=ka,jb=la,kb=ma,lb=na;wa.async=Sa,wa.after=function(a){setTimeout(a,0)};if("undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var mb=window.__PROMISE_INSTRUMENTATION__;g("instrument",!0);for(var nb in mb)mb.hasOwnProperty(nb)&&pa(nb,mb[nb])}var ob={race:ib,Promise:Ha,allSettled:Pa,hash:cb,hashSettled:bb,denodeify:gb,on:pa,off:qa,map:db,filter:$a,resolve:kb,reject:jb,all:Qa,rethrow:lb,defer:Za,EventTarget:va,configure:g,async:oa};"function"==typeof define&&define.amd?define(function(){return ob}):"undefined"!=typeof module&&module.exports?module.exports=ob:"undefined"!=typeof hb&&(hb.RSVP=ob)}).call(this),function(a,b,c,d){"use strict";if(a.Promise=a.Promise?a.Promise:RSVP.Promise,c.Utils={},c.SP={},c.Yam={},c.Utils.Conversion={},c.Utils.Conversion.objToQueryString=function(a){var b="";for(var c in a)b+="&$"+c+"="+a[c];return b},c.Utils.Conversion.spInternalName=function(a){return str.replace(/ /g,"_x0020_")},c.Utils.Objects={},c.Utils.Objects.findObjectByProperty=function(a,b,c){var d;for(d=0;d<a.length;d++)if(a[d][b]===c)return a[d];return!1},c.Utils.Objects.merge=function(a,b){for(var c in b)try{b[c].constructor==Object?a[c]=MergeRecursive(a[c],b[c]):a[c]=b[c]}catch(d){a[c]=b[c]}return a},c.Utils.Request={},c.Utils.Request.get=function(a,b){return new Promise(function(d,e){var f=c.Utils.Storage.get("SPOC-"+a);if(f&&b)d(f);else if(c.Mock&&c.Mock.active){a=c.Utils.Url.getListNameFromUrl(a);var g=c.Mock.db[a];g?d(g):e({error:"no mock data found for the list - "+a})}else{!c.Utils.Url.isSameDomain(a)&&a.toLowerCase().indexOf("_api/web")>-1&&(a=c.Utils.Url.convertToXDomain(a));var h=new XMLHttpRequest;h.open("GET",a,!0),h.setRequestHeader("Accept","application/json;odata=verbose"),h.onreadystatechange=function(){if(4==h.readyState)if(200==h.status){var b=JSON.parse(h.responseText);b=b.d.results?b.d.results:b.d,c.Utils.Storage.set("SPOC-"+a,b),d(b)}else e(Error(JSON.parse(h.statusText)))},h.onerror=function(a){e(Error("Network Error"))},h.send()}})},c.Utils.Request.post=function(a,d,e){return new Promise(function(f,g){if(c.Mock&&c.Mock.active)a=c.Utils.Url.getListNameFromUrl(a),c.Mock.db[a]=d,f(d);else{!c.Utils.Url.isSameDomain(a)&&a.toLowerCase().indexOf("_api/web")>-1&&(a=c.Utils.Url.convertToXDomain(a));var h=new XMLHttpRequest;h.open("POST",a,!0),h.setRequestHeader("Accept","application/json;odata=verbose"),h.setRequestHeader("X-RequestDigest",b.getElementById("__REQUESTDIGEST").value),h.setRequestHeader("Content-Type","application/json;odata=verbose"),e&&h.setRequestHeader("content-length",d.byteLength),h.onreadystatechange=function(){4==h.readyState&&(200==h.status?f(d):g(Error(h.statusText)))},h.onerror=function(a){g(Error("Network Error"))},h.send(e?d:JSON.stringify(d))}})},c.Utils.Request.put=function(a,d){return new Promise(function(e,f){if(c.Mock&&c.Mock.active){a=c.Utils.Url.getListNameFromUrl(a);var g=c.Mock.db[a];g?(c.Mock.db[a]=d,e(d)):f({error:"no mock data found for the list - "+a})}else{!c.Utils.Url.isSameDomain(a)&&a.toLowerCase().indexOf("_api/web")>-1&&(a=c.Utils.Url.convertToXDomain(a));var h=new XMLHttpRequest;h.open("POST",a,!0),h.setRequestHeader("Accept","application/json;odata=verbose"),h.setRequestHeader("X-RequestDigest",b.getElementById("__REQUESTDIGEST").value),h.setRequestHeader("Content-Type","application/json;odata=verbose"),h.setRequestHeader("X-HTTP-Method","MERGE"),h.setRequestHeader("If-Match","*"),h.onreadystatechange=function(){4==h.readyState&&(200==h.status?e(d):f(Error(h.statusText)))},h.onerror=function(a){f(Error("Network Error"))},h.send(JSON.stringify(d))}})},c.Utils.Request["delete"]=function(a,d){return new Promise(function(e,f){if(c.Mock.active)e(d);else{!c.Utils.Url.isSameDomain(a)&&a.toLowerCase().indexOf("_api/web")>-1&&(a=c.Utils.Url.convertToXDomain(a));var g=new XMLHttpRequest;g.open("POST",a,!0),g.setRequestHeader("X-RequestDigest",b.getElementById("__REQUESTDIGEST").value),g.setRequestHeader("X-HTTP-Method","DELETE"),g.setRequestHeader("If-Match","*"),g.onreadystatechange=function(){4==g.readyState&&(200==g.status?e(d):f(Error(g.statusText)))},g.onerror=function(a){f(Error("Network Error"))},g.send(JSON.stringify(d))}})},c.Utils.Request.loadScript=function(a,c,d){new Promise(function(c,d){var e=b.createElement("script");e.src=a,e.addEventListener("load",function(){c(a)},!1),e.addEventListener("error",function(){d(a)},!1),b.body.appendChild(e)})},c.Utils.SP={},c.Utils.SP.getListItemType=function(a){return a=a[0].toUpperCase()+a.substring(1),"SP.Data."+a.replace(/ /g,"_x0020_")+"ListItem"},c.Utils.SP.isAppWeb=function(){return a.location.href.toLowerCase().indexOf("sphosturl")>-1?!0:!1},c.Utils.SP.convertToWebApp=function(a){if(a.toLowerCase().indexOf("WopiFrame.aspx")>-1)return a;var b=c.Utils.Strings.getFileExtension(a);return"docx"===b||"pptx"===b||"xlsx"===b?site.url+"/_layouts/15/WopiFrame.aspx?sourcedoc="+a:a},c.Utils.SP.formatSearchResponse=function(a){var b,c,d,e,f=a.query.PrimaryQueryResult.RelevantResults.Table.Rows,g=[];for(f=f.results?f.results:[f],d=0;d<f.length;d++){for(b=f[d].Cells.results,c={},e=0;e<b.length;e++)c[b[e].Key]=b[e].Value;g.push(c)}return g},c.Utils.Storage={},c.Utils.Storage.storageAvailable=function(){return"undefined"!=typeof Storage},c.Utils.Storage.set=function(a,b,d){if(c.Utils.Storage.storageAvailable()){var e=d?localStorage:sessionStorage;e.setItem(a,b===Object(b)?JSON.stringify(b):b)}},c.Utils.Storage.get=function(a,b){if(c.Utils.Storage.storageAvailable()){var d=b?localStorage:sessionStorage;return JSON.parse(d.getItem(a))}return null},c.Utils.Storage.remove=function(a,b){if(c.Utils.Storage.storageAvailable()){b?localStorage:sessionStorage;localStorage.removeItem(a)}},c.Utils.Storage.getCookie=function(a){a+="=";for(var c=b.cookie.split(";"),d=0;d<c.length;d++){var e=c[d].trim();if(0===e.indexOf(a))return e.substring(a.length,e.length)}return!1},c.Utils.Storage.setCookies=function(a,c,d){var e;if(d){var f=new Date;f.setTime(f.getTime()+24*d*60*60*1e3),e="; expires="+f.toGMTString()}else e="";b.cookie=a+"="+c+"; "+e},c.Utils.Storage.removeCookies=function(a){c.Utils.Storage.setCookies(a,"",-1)},c.Utils.Strings={},c.Utils.Strings.cut=function(a,b){return a.length>b?a.substr(0,b-3)+"...":a},c.Utils.Strings.getFileExtension=function(a){return a.split(".").pop()},c.Utils.Tpl={},c.Utils.Tpl.getProperty=function(a,b){var c,d=a.split("."),e=d.length,f=b||this;for(c=0;e>c;c++)f=f[d[c]];return f},c.Utils.Tpl.render=function(a,b){var d=/{{(.*?)}}/g,e=a.match(d);if(e&&e.length)for(var f=0,g=e.length;g>f;f++)a=a.replace(new RegExp(e[f],"g"),c.Utils.Tpl.getProperty(e[f].replace(/{{|}}/g,""),b));return a},c.Utils.Url={},c.Utils.Url.getQueryString=function(b,c){c=c?c.split("?")[1]:a.location.search.substring(1);for(var d=c.split("&"),e=0;e<d.length;e++){var f=d[e].split("=");if(f[0]==b)return unescape(f[1])}},c.Utils.Url.getListNameFromUrl=function(a){var b=/\%27(.*)\%27/g,c=b.exec(a);return c?c[1]:null},c.Utils.Url.AppWebUrl=function(a){return c.Utils.Url.getQueryString("SPAppWebUrl")},c.Utils.Url.isSameDomain=function(b){var c=a.location.href.toLowerCase();return b.toLowerCase().indexOf(c)>-1?!0:!1},c.Utils.Url.convertToXDomain=function(b){b=b.toLowerCase(),b=b.replace("/_api/","/_api/SP.AppContextSite(@target)/");var c=b.split("/_api")[0];return b=b.split("/_api")[1],-1===b.indexOf("?")&&(b+="?"),b=a.location.origin+"/_api"+b+"@target=%27"+c+"%27"},c.Utils.Yammer={},c.Utils.Yammer.formatFeedResponse=function(a){var b,d=[];for(b=0;b<a.messages.length;b++)a.messages[b].replied_to_id||a.messages[b].sender_type&&"user"===a.messages[b].sender_type&&(a.messages[b].user=c.Utils.Arrays.findByProperty(a.references,"id",a.messages[b].sender_id),d.push(a.messages[b]));return d},c.Utils.Yammer.formatSearchResponse=function(a){var b;if(a.messages&&a.messages.messages)for(b=0;b<a.messages.messages.length;b++){var d=a.messages.messages[b];d.sender_type&&"user"===d.sender_type&&(d.user=c.Utils.Arrays.findByProperty(a.messages.references,"id",d.sender_id))}return a},c.Utils.Yammer.checkLogin=function(a){return new Promise(function(b,c){yam.getLoginStatus(function(c){c.authResponse?deferred.resolve(c):a?yam.platform.login(function(a){b(a?a:!1)}):b(c)})})},c.Mock={active:!1,db:{}},!a._spPageContextInfo){var e=c.Utils.Url.AppWebUrl();a._spPageContextInfo={userId:1,userLoginName:"test",webAbsoluteUrl:e?e:"local"},e||(c.Mock.active=!0)}c.Mock.dummyText=function(a,b,c){var d=new Array("lorem","ipsum","dolor","sit","amet,","consectetur","adipisicing","elit,","sed","do","eiusmod","tempor","incididunt","ut","labore","et","dolore","magna","aliqua.","enim","ad","minim","veniam,","quis","nostrud","exercitation","ullamco","laboris","nisi","ut","aliquip","ex","ea","commodo","consequat.","duis","aute","irure","dolor","in","reprehenderit","in","voluptate","velit","esse","cillum","dolore","eu","fugiat","nulla","pariatur.","excepteur","sint","occaecat","cupidatat","non","proident,","sunt","in","culpa","qui","officia","deserunt","mollit","anim","id","est","laborum.","sed","ut","perspiciatis,","unde","omnis","iste","natus","error","sit","voluptatem","accusantium","doloremque","laudantium,","totam","rem","aperiam","eaque","ipsa,","quae","ab","illo","inventore","veritatis","et","quasi","architecto","beatae","vitae","dicta","sunt,","explicabo.","nemo","enim","ipsam","voluptatem,","quia","voluptas","sit,","aspernatur","aut","odit","aut","fugit,","sed","quia","consequuntur","magni","dolores","eos,","qui","ratione","voluptatem","sequi","nesciunt,","neque","porro","quisquam","est,","qui","dolorem","ipsum,","quia","dolor","sit,","amet,","consectetur,","adipisci","velit,","sed","quia","non","numquam","eius","modi","tempora","incidunt,","ut","labore","et","dolore","magnam","aliquam","quaerat","voluptatem.","ut","enim","ad","minima","veniam,","quis","nostrum","exercitationem","ullam","corporis","suscipit","laboriosam,","nisi","ut","aliquid","ex","ea","commodi","consequatur?","quis","autem","vel","eum","iure","reprehenderit,","qui","in","ea","voluptate","velit","esse,","quam","nihil","molestiae","consequatur,","vel","illum,","qui","dolorem","eum","fugiat,","quo","voluptas","nulla","pariatur?","at","vero","eos","et","accusamus","et","iusto","odio","dignissimos","ducimus,","qui","blanditiis","praesentium","voluptatum","deleniti","atque","corrupti,","quos","dolores","et","quas","molestias","excepturi","sint,","obcaecati","cupiditate","non","provident,","similique","sunt","in","culpa,","qui","officia","deserunt","mollitia","animi,","id","est","laborum","et","dolorum","fuga.","harum","quidem","rerum","facilis","est","et","expedita","distinctio.","Nam","libero","tempore,","cum","soluta","nobis","est","eligendi","optio,","cumque","nihil","impedit,","quo","minus","id,","quod","maxime","placeat,","facere","possimus,","omnis","voluptas","assumenda","est,","omnis","dolor","repellendus.","temporibus","autem","quibusdam","aut","officiis","debitis","aut","rerum","necessitatibus","saepe","eveniet,","ut","et","voluptates","repudiandae","sint","molestiae","non","recusandae.","itaque","earum","rerum","hic","tenetur","a","sapiente","delectus,","aut","reiciendis","voluptatibus","maiores","alias","consequatur","aut","perferendis","doloribus","asperiores","repellat"),e=["docx","jpeg","pptx","xlsx","pdf","mp4","txt"],f=b?e[Math.floor(Math.random()*e.length)]:"",g="",h="",i="";c=c?c:" ";for(var j=0;a>j;j++)i=d[Math.floor(Math.random()*(d.length-1))],("."==h.substring(h.length-1,h.length)||"?"==h.substring(h.length-1,h.length))&&(i=i.substring(0,1).toUpperCase()+i.substring(1,i.length)),h+=c+i;return b&&(h=h.replace(/,/g,"")),g=h.substring(1,h.length-1)+"."+f,g.charAt(0).toUpperCase()+g.slice(1)},c.Mock.dummyImage=function(a,b,c){return a=a?a:600,b=b?b:400,"http://lorempixel.com/"+a+"/"+b+"/"+(c?c:"")},c.Mock.createList=function(a,b){c.Mock.db[a.toLowerCase()]=b},c.SP.Site=function(b){this.url=b?b:a._spPageContextInfo.webAbsoluteUrl},c.SP.User=function(b){this.id=b?b:a._spPageContextInfo.userId,this.loginName=b?b:a._spPageContextInfo.userLoginName},c.Yam.User=function(b){a.yam||console.log("Please ensure that you have included Yammer SDK and added a valid Client Id"),this.id=b?b:"current"},c.Yam.Feed=function(b,c){a.yam||console.log("Please ensure that you have included Yammer SDK and added a valid Client Id"),this.feedId=b,this.feedType=c},c.SP.Site.prototype.Delve=function(a){var b=this,d={};return d.board=function(d,e,f){return new Promise(function(g,h){var i,j;d||(d="*"),a?(i=b.url+"/_api/search/query?Querytext=%27WorkEmail:"+a+"%27&SelectProperties=%27UserName,DocId%27",c.Utils.Request.get(i,f).then(function(a){a=c.Utils.SP.formatSearchResponse(a),a.length?(a.length>1&&(a=a[0]),j=a.DocId,i=b.url+"/_api/search/query?Querytext='"+d+"'&amp;Properties='GraphQuery:ACTOR("+j+e?", "+e:")",c.Utils.Request.get(i,f).then(function(a){a=c.Utils.SP.formatSearchResponse(a),g(a)},function(a){h(a)})):g(null)},function(a){h(a)})):(i=b.url+"/_api/search/query?Querytext='"+d+"'&amp;Properties='GraphQuery:ACTOR(ME"+e?", "+e:")",c.Utils.Request.get(i,f).then(function(a){a=c.Utils.SP.formatSearchResponse(a),g(a)},function(a){h(a)}))})},d},c.SP.Site.prototype.Files=function(b){var d=this,e={};return"/"!==b.charAt(0)&&(b="/"+b),e.generateExternalLink=function(a){a=a?a:24;var e=d.url+"/_api/Web/GetFileByServerRelativeUrl('"+b+"')/GetPreAuthorizedAccessUrl("+a+")";return c.Utils.Request.get(e,!0)},e.uploadViaModal=function(a){return new Promise(function(b,c){var e={};e.url=d.url+"/_layouts/Upload.aspx?List="+a+"&IsDlg=1",e.dialogReturnValueCallback=Function.createDelegate(null,function(a,c){b(c)}),SP.UI.ModalDialog.showModalDialog(e)})},e.upload=function(a){return new Promise(function(e,f){var g=new FileReader;g.onloadend=function(g){var h=a.value.split("\\"),i=h[h.length-1],j=d.url+"/_api/Web/GetFolderByServerRelativeUrl('"+b+"')/files/add(overwrite=true, url='"+i+"')";c.Utils.Request.post(j,g.target.result,!0).then(function(a){e(a)},function(a){f(a)})},g.onerror=function(a){f(a.target.error)},g.readAsArrayBuffer(a.files[0])})},e.query=function(a){var e=d.url+"/_api/web/getfilebyserverrelativeurl('"+b+"')/ListItemAllFields";return c.Utils.Request.get(e,a)},e.download=function(){a.open("/_layouts/download.aspx?SourceUrl="+d.url+b)},e.openInWebApps=function(e){var f=d.url+b;e?a.open(c.Utils.SP.convertToWebApp(f)):a.location.href=c.Utils.SP.convertToWebApp(f)},e},c.SP.Site.prototype.ListItems=function(a){var b=this,d={};return d.query=function(d,e,f){var g=b.url+"/_api/web/lists/getByTitle%28%27"+a+"%27%29/items";return g+=d?"?"+c.Utils.Conversion.objToQueryString(d):"",c.Utils.Request.get(g,e)},d.create=function(d){var e=b.url+"/_api/web/lists/getByTitle%28%27"+a+"%27%29/items",f={__metadata:{type:c.Utils.SP.getListItemType(a)}};return d&&(f=c.Utils.Objects.merge(f,d)),c.Utils.Request.post(e,f)},d.update=function(d,e){var f=b.url+"/_api/web/lists/getByTitle%28%27"+a+"%27%29/items("+d+")",g={__metadata:{type:c.Utils.SP.getListItemType(a)}};return e&&(g=c.Utils.Objects.merge(g,e)),c.Utils.Request.put(f,g)},d["delete"]=function(d){var e=b.url+"/_api/web/lists/getByTitle%28%27"+a+"%27%29/items("+d+")",f={__metadata:{type:c.Utils.SP.getListItemType(a)}};return c.Utils.Request["delete"](e,f)},d},c.SP.Site.prototype.Lists=function(a){var b=this,d={};return d.query=function(d,e){var f=b.url+"/_api/web/lists/getByTitle%28%27"+a+"%27%29/";return f+=d?"?"+c.Utils.Conversion.objToQueryString(d):"",c.Utils.Request.get(f,e)},d.create=function(a){var d={__metadata:{type:"SP.List"},BaseTemplate:100,Description:""};a&&(d=c.Utils.Objects.merge(d,a));var e=b.url+"/_api/web/lists";return c.Utils.Request.post(e,d)},d},c.SP.Site.prototype.Search=function(a){var b=this,d={};return d.query=function(d,e){return new Promise(function(f,g){var h=b.url+"/_api/search/query?querytext=%27"+a+" +path:"+b.url+"%27";h+=d?"?"+c.Utils.Conversion.objToQueryString(d):"",c.Utils.Request.get(h,e).then(function(a){a=c.Utils.SP.formatSearchResponse(a),f(a)},function(a){g(a)})})},d},c.SP.User.prototype.Profile=function(){var b=this,d={},e="i:0%23.f|membership|";return d.query=function(d){var f=a._spPageContextInfo.webAbsoluteUrl;return f+=b.loginName?"/_api/SP.UserProfiles.PeopleManager/GetPropertiesFor(accountName=@v)?@v=%27"+e+b.loginName+"%27":"/_api/SP.UserProfiles.PeopleManager/GetMyProperties/UserProfileProperties",c.Utils.Request.get(f,d)},d.isMemberOfGroup=function(b,d,e){var f=d?d:a._spPageContextInfo.userId,g=site.url+"/_api/web/sitegroups/getByName('"+b+"')/Users?$filter=Id eq "+f;return c.Utils.Request.get(g,e)},d},c.Yam.Feed.prototype.posts=function(){var a=this,b={},d="messages/following.json";return a.feedId&&(d="in_group"),b.query=function(a){return new Promise(function(b,e){c.Utils.Yammer.checkLogin().then(function(f){f?yam.platform.request({url:d,method:"GET",data:a?a:null,success:function(a){a=c.Utils.Yammer.formatFeedResponse(a),b(a)},error:function(a){e(a)}}):b(!1)})})},b},c.Yam.Search=function(){var a={},b="search.json";return a.query=function(a,d){return new Promise(function(d,e){c.Utils.Yammer.checkLogin().then(function(f){f?yam.platform.request({url:b,method:"GET",data:a?a:null,success:function(b){b=c.Utils.Yammer.formatSearchResponse(b),c.Utils.Storage.set("SPOC-yam-search-"+JSON.stringify(a),b),d(b)},error:function(a){e(a)}}):d(!1)})})},a},c.Yam.User.prototype.Subscriptions=function(){var a=this,b={};return b.query=function(b,d){return new Promise(function(d,e){c.Utils.Yammer.checkLogin().then(function(f){f?yam.platform.request({url:"subscriptions/to_user/"+a.id+".json",method:"GET",data:b?b:null,success:function(b){c.Utils.Storage.set("SPOC-yam-subs-"+a.id,b),d(b)},error:function(a){e(a)}}):d(!1)})})},b},c.Yam.User.prototype.Profile=function(){var a=this,b={};return b.query=function(b,d){return new Promise(function(d,e){c.Utils.Yammer.checkLogin().then(function(f){f?yam.platform.request({url:"users/"+a.id+".json",method:"GET",data:b?b:null,success:function(b){c.Utils.Storage.set("SPOCC-yam-users-"+a.id,b),d(b)},error:function(a){e(a)}}):d(!1)})})},b}}(window,document,window.SPOC=window.SPOC||{});